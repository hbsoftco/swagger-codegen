language: java

jdk:
- oraclejdk8
# no need to test jdk7 as smoke test is already covered by travis-ci
#- openjdk7

build:
  cache: true
  cache_dir_list:
    - $HOME/.m2
  pre_ci:
    - echo $PWD
    - pwd
    - echo $HOME
    # install typescript
    - npm install -g typescript
    # start petstore
    - docker ps -a
    - docker stop $(docker ps -q -f "name=swaggerapi/petstore")
    - docker ps -a
    - docker pull swaggerapi/petstore
    - docker run -d -e SWAGGER_HOST=http://petstore.swagger.io -e SWAGGER_BASE_PATH=/v2 -p 80:8080 swaggerapi/petstore
    - docker ps -a

  ci:
    ### test JS/TS clients
    # test TS jquery
    - cd "${SHIPPABLE_BUILD_DIR }/samples/client/petstore/typescript-jquery/npm/" && npm install
    # test TS fetch
    - cd "${SHIPPABLE_BUILD_DIR }/samples/client/petstore/typescript-fetch/builds/default" && npm install
    # generate all petstore sampless (client, servers, doc)
    - ./bin/run-all-petstore 2>&1 > run-all-petstore.log
  post_ci:
    - tail run-all-petstore.log
